---
title: "Analysis"
output: html_document
---
```{r setup}
# Load packages
library(tidyverse)
library(ggplot2) 
library(readxl) 
library(lubridate)
library(broom)
library(viridis)
library(tsModel)

# Global options
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

``` 

This contains all code used to analyze the datasets found in the `/CleanData` directory, which were previously generated in the `/Scripts/Cleaning.rmd` file.

#Introduction

There are several studies that use the interupted time series ARIMA, but we are primarily going to replicate the methods described in [Singh et al., 2025](https://link.springer.com/article/10.1007/s00127-025-02902-7), a study which analyzes suicide deaths among reproductive-aged women post-*Dobbs*. 

This study also uses data from the Multiple Cause of Death database, and stratifies data by men and women by two age groups: 15-25 and 25-49. The outcomes are the monthly count of suicides nationally for reproductive-aged women overall and for the two age subgroups. The series of monthly suicides among men (per age group) were used as a control variable. The exposure was the timing of the *Dobbs* decision in June 2022. 

To extend this methodology to our study, we can also use male deaths as a control. Since we are using just texas data, it is unlikely that we will have enough counts to populate data if we further stratify by age 15-24 and 25-49. However, we will also do a sensitivity analysis that compares our trends to those nationally. 

*Note: the following description is directly adapted from Singh et al. (2025). Future methods manuscripting will need to cite this source as well as adapt the phrasing.*

The ARIMA's autoregressive (AR) component should allow us to capture the relationship between current assault mortality counts and past observations. The moving average (MA) will model the residuals from previous time points (accounting for irregular fluctuations). The seasonality/trends that change over time will be addressed through differencing ("integrated"), which will remove secular trends and stabilize the mean. 

We may use the methods from Singh et al. (2025) in the following steps: 

1. Use the Box-Jenkins iterative pattern recognition routines to identify the ARIMA signature of the outcome in the pre-Bill 8 period (January, 2018 - August, 2021), controlling for the concomitant series of assault mortality among men of the same age group (15-44).  

2. Use the pre-Bill 8 ARIMA signature identified in step 1 to forecast (predict) values of the outcome for the 28-month period post-Bill 8 (i.e. September 2021 - December 2023). These predicted/fitted values will serve as counterfactuals and reflect the expected monthly count of female suicides if Bill 8 had not been passed. 

3. Use the ARIMA signature identified in step 1 and expected values from step 2 to obtain residual values (observed less fitted) of our outcome series. 

4. Use the pre-Bill 8 standard error of residuals to develop pre-Bill 8 95% confidence intervals (CI; prediction interval of monthly series of assault mortalities among Texas resident reproductive-aged women overall from January 2018 - August 2021). Extend the pre-Bill 8 prediction interval to the full residual series (January 2018 - December 2023). Next, note whether any residuals deviated from this prediction interval post-Bill 8 (i.e., September 2021 onward.)

5. If the outcome series exhibited outliers in the post-Bill 8 period following step 4, create a binary indicator of the month-specified timing of any identified outliers in residuals of assault mortalities among reproductive-aged women post-Bill 8 (1 for months with outliers, 0 otherwise) to quantify the average change in assault mortalities post-Bill 8. This will also help avoid multiple testing that could increase chances of a Type I error (false rejection of the null). 

6. Apply the binary-indicator of month-specific outliers (from step 5) to the ARIMA-derived residuals of outcomes to determine the magnitude of outcome deviation from expected levels in the months with residual outliers. 

2-tailed tests with significance level of p < 0.05 will be used. 

#Descriptive Statistics 

We are going to start by exploring how many assault mortalities among Texas residents occured between the study period, comparing women and men. 

```{r import}
monthly_f <- read.csv("../CleanData/monthly_f.csv") 
monthly_m <- read.csv("../CleanData/monthly_m.csv")
monthly_all <- read.csv("../CleanData/monthly_all.csv")

```


```{r descriptive}
monthly_all %>%
  group_by(sex) %>%
  summarise(
    n_months      = n(),
    total_deaths  = sum(Deaths, na.rm = TRUE),
    monthly_mean  = mean(Deaths, na.rm = TRUE),
    monthly_sd    = sd(Deaths, na.rm = TRUE),
    .groups = "drop"
  )
monthly_all %>%
  filter(month_year == "2021-09-01") %>%
  pull(time)
monthly_all %>%
  filter(month_year == as.Date("2021-09-01")) %>%
  select(sex, month_year, time)

```

[insert same statistics, this time for national trends]



